<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Spaceman - Client Only (Admin + Users)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bg:#071024;--panel:#0f1724;--accent:#ffb86b;--muted:#9aa6b2;}
    body{font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#001);color:#fff;margin:0;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:20px;}
    .wrap{width:100%;max-width:980px;}
    .card{background:linear-gradient(180deg,#071827,#02121a);padding:14px;border-radius:10px;margin-bottom:12px;box-shadow:0 6px 20px rgba(0,0,0,0.6);}
    h1{margin:0 0 8px 0;font-size:20px;color:var(--accent)}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .balance{background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;font-weight:700}
    .btn{background:#0ea5a4;border:none;padding:8px 12px;border-radius:8px;color:#001;font-weight:800;cursor:pointer}
    input,select{padding:8px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:#fff}
    #gameArea{height:420px;border-radius:10px;position:relative;overflow:hidden;background:linear-gradient(to top,#00121b,#072033);display:flex;align-items:flex-end;justify-content:center}
    #rocket{font-size:64px;position:relative;bottom:12px;transition:bottom 120ms linear;}
    #mult{position:absolute;left:16px;top:16px;font-size:24px;color:#9effc7;font-weight:800}
    #countdown{position:absolute;right:16px;top:16px;color:yellow;font-weight:900}
    #historyBar{display:flex;gap:6px;flex-wrap:wrap;margin-top:10px}
    .hist{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03);font-weight:700}
    .low{background:rgba(255,90,90,0.12);color:#ff9a9a}
    .mid{background:rgba(255,215,125,0.08);color:#ffd27f}
    .high{background:rgba(120,255,180,0.06);color:#9effc7}
    /* auth modal */
    #auth{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:60}
    #auth .box{width:100%;max-width:360px;background:linear-gradient(180deg,#071827,#02121a);padding:16px;border-radius:10px}
    /* deposit/withdraw modal */
    #depositWithdrawModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:60}
    #depositWithdrawModal .box{width:100%;max-width:400px;background:linear-gradient(180deg,#071827,#02121a);padding:16px;border-radius:10px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03)}
    .small{font-size:13px;color:var(--muted)}
    .pending{color:#ffb86b}
    .approved{color:#9effc7}
    .rejected{color:#ff6b6b}
    .transaction-history {max-height: 200px; overflow-y: auto; margin-top: 12px;}
    @media (max-width:640px){ #rocket{font-size:44px} #gameArea{height:320px} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="topBar">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><h1>ðŸš€ spacmen99 Ã— 0831-8587-5124</h1><div class="small">nomor cs diatas jika mau desposit dan wd dll,silakan hubungin nomor diatas</div></div>
        <div class="row">
          <div class="balance" id="displayBalance">Rp 0</div>
          <button class="btn" id="btnDeposit" style="display:none">Deposit</button>
          <button class="btn" id="btnWithdraw" style="display:none">Withdraw</button>
          <button class="btn" id="btnProfile" style="display:none">Profile</button>
          <button class="btn" id="btnLogout" style="display:none">Logout</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div id="gameArea">
        <div id="mult">x1.00</div>
        <div id="countdown"></div>
        <div id="rocket">ðŸš€</div>
      </div>

      <div style="margin-top:12px" class="row">
        <input type="number" id="betInput" value="1000" min="100" step="100">
        <input type="number" id="autoInput" placeholder="Auto cashout x (ex:2.5)" step="0.1" min="1.1">
        <button class="btn" id="btnPlace">Taruhan</button>
        <button class="btn" id="btnHalf">Tarik 50%</button>
        <button class="btn" id="btnFull">Tarik Full</button>
        <div class="small" id="roundState">Ronde: -</div>
      </div>

      <div id="historyBar" class="small"></div>
    </div>

    <div class="card" id="adminPanel" style="display:none">
      <h3>Admin Panel (adminfeb)</h3>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <input id="adminUser" placeholder="username">
        <input id="adminAmount" placeholder="amount" type="number">
        <button class="btn" id="btnAddBalance">Tambah Saldo</button>
        <button class="btn" id="btnResetAll">Reset Semua</button>
      </div>
      
      <h4 style="margin-top:12px">Pending Transactions</h4>
      <div class="transaction-history">
        <table id="pendingTransactionsTable">
          <thead><tr><th>User</th><th>Type</th><th>Amount</th><th>Action</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      
      <h4 style="margin-top:12px">Users</h4>
      <table id="usersTable"><thead><tr><th>User</th><th>Saldo</th><th>Action</th></tr></thead><tbody></tbody></table>
    </div>
  </div>

  <!-- Auth modal -->
  <div id="auth">
    <div class="box">
      <h2>Login / Register</h2>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <input id="inputUser" placeholder="username">
        <input id="inputPass" placeholder="password" type="password">
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn" id="btnLogin">Login</button>
        <button class="btn" id="btnRegister">Register</button>
      </div>
      <p class="small" style="margin-top:8px">cs admin: <b>untuk deposit/wd silakan hubungin admin caca</b> / <b>email:xzrbrian@gmail.com -
     nomor wa:0831-8587-5124</b></p>
      <p id="authMsg" class="small"></p>
    </div>
  </div>

  <!-- Deposit/Withdraw Modal -->
  <div id="depositWithdrawModal">
    <div class="box">
      <h2 id="dwTitle">Deposit</h2>
      <div style="margin-bottom:12px">
        <input type="number" id="dwAmount" placeholder="Jumlah" min="10000" step="10000">
      </div>
      <div style="margin-bottom:12px">
        <input type="text" id="dwMethod" placeholder="Metode (BCA/BRI/OVO/etc)">
      </div>
      <div style="margin-bottom:12px">
        <input type="text" id="dwAccount" placeholder="NOMOR PENGIRIM">
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn" id="btnSubmitDW">Submit</button>
        <button class="btn" style="background:#6b7280" id="btnCancelDW">Batal</button>
      </div>
      <p class="small" style="margin-top:8px">dana/gopay/pulsa - 0831-7751-5605 setelah melakukan transaksi silakan kirim bukti tf ke nomor wa admin itu nomor wa 0831-8587-5124 - makasihhh yap</p>
      <div id="dwMsg" class="small"></div>
      
      <h3 style="margin-top:16px">Riwayat Transaksi</h3>
      <div class="transaction-history">
        <table id="transactionHistoryTable">
          <thead><tr><th>Type</th><th>Amount</th><th>Status</th><th>Date</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

<script>
/*
  Client-only Spaceman
  - Users and balances stored in localStorage
  - Admin user: adminfeb / admin
  - Rounds run continuously: 5s countdown -> flight -> crash
  - Bets handled locally; auto-cashout supported
  - Added Deposit/Withdraw functionality
*/

// Utilities
const $ = sel => document.querySelector(sel);
const format = n => Number(n).toLocaleString();

// LocalStorage keys
const LS_USERS = 'sp_users_v1';
const LS_HISTORY = 'sp_history_v1';
const LS_CURRENT = 'sp_current_user_v1';
const LS_TRANSACTIONS = 'sp_transactions_v1';

// Default data setup
function loadUsers(){
  const raw = localStorage.getItem(LS_USERS);
  if(!raw){
    const defaultUsers = { 'adminfeb': { password: 'admin', balance: 1000000, isAdmin:true } };
    localStorage.setItem(LS_USERS, JSON.stringify(defaultUsers));
    return defaultUsers;
  }
  return JSON.parse(raw);
}
function saveUsers(u){ localStorage.setItem(LS_USERS, JSON.stringify(u)); }

function loadHistory(){ return JSON.parse(localStorage.getItem(LS_HISTORY) || '[]'); }
function saveHistory(h){ localStorage.setItem(LS_HISTORY, JSON.stringify(h)); }

function loadTransactions(){ return JSON.parse(localStorage.getItem(LS_TRANSACTIONS) || '[]'); }
function saveTransactions(t){ localStorage.setItem(LS_TRANSACTIONS, JSON.stringify(t)); }

let users = loadUsers();
let history = loadHistory();
let transactions = loadTransactions();
let currentUser = localStorage.getItem(LS_CURRENT) || null;
let currentDWType = ''; // 'deposit' or 'withdraw'

// Auth UI
const authModal = $('#auth');
const inputUser = $('#inputUser');
const inputPass = $('#inputPass');
const authMsg = $('#authMsg');
const btnLogin = $('#btnLogin');
const btnRegister = $('#btnRegister');
const btnLogout = $('#btnLogout');
const btnProfile = $('#btnProfile');
const btnDeposit = $('#btnDeposit');
const btnWithdraw = $('#btnWithdraw');

// Deposit/Withdraw UI
const dwModal = $('#depositWithdrawModal');
const dwTitle = $('#dwTitle');
const dwAmount = $('#dwAmount');
const dwMethod = $('#dwMethod');
const dwAccount = $('#dwAccount');
const btnSubmitDW = $('#btnSubmitDW');
const btnCancelDW = $('#btnCancelDW');
const dwMsg = $('#dwMsg');

function showAuth(){ authModal.style.display='flex'; }
function hideAuth(){ authModal.style.display='none'; }

function showDWModal(type) {
  currentDWType = type;
  dwTitle.innerText = type === 'deposit' ? 'Deposit' : 'Withdraw';
  dwAmount.value = '';
  dwMethod.value = '';
  dwAccount.value = '';
  dwMsg.innerText = '';
  renderTransactionHistory();
  dwModal.style.display = 'flex';
}

function hideDWModal() {
  dwModal.style.display = 'none';
}

function setCurrent(user){
  currentUser = user;
  if(user) localStorage.setItem(LS_CURRENT, user);
  else { localStorage.removeItem(LS_CURRENT); currentUser = null; }
  renderAuthState();
}

function renderAuthState(){
  if(currentUser){
    authModal.style.display='none';
    $('#btnLogout').style.display='inline-block';
    $('#btnProfile').style.display='inline-block';
    $('#btnDeposit').style.display='inline-block';
    $('#btnWithdraw').style.display='inline-block';
    $('#displayBalance').innerText = 'Rp ' + format(users[currentUser].balance || 0);
    if(users[currentUser].isAdmin) {
      $('#adminPanel').style.display='block';
      renderPendingTransactions();
    } else {
      $('#adminPanel').style.display='none';
    }
  } else {
    $('#btnLogout').style.display='none';
    $('#btnProfile').style.display='none';
    $('#btnDeposit').style.display='none';
    $('#btnWithdraw').style.display='none';
    $('#displayBalance').innerText = 'Rp 0';
    $('#adminPanel').style.display='none';
  }
  renderUsersTable();
}

// Register / Login handlers
btnRegister.onclick = ()=>{
  const u = inputUser.value.trim();
  const p = inputPass.value;
  if(!u || !p){ authMsg.innerText='Isi username & password'; return; }
  users = loadUsers();
  if(users[u]){ authMsg.innerText='Username sudah ada'; return; }
  users[u] = { password: p, balance: 10000, isAdmin:false };
  saveUsers(users);
  setCurrent(u);
  authMsg.innerText='Terdaftar & login';
}

btnLogin.onclick = ()=>{
  const u = inputUser.value.trim();
  const p = inputPass.value;
  if(!u || !p){ authMsg.innerText='Isi username & password'; return; }
  users = loadUsers();
  if(!users[u] || users[u].password !== p){ authMsg.innerText='Username/password salah'; return; }
  setCurrent(u);
  authMsg.innerText='Login berhasil';
}

// Logout/Profile
btnLogout.onclick = ()=>{ setCurrent(null); showAuth(); }
btnProfile.onclick = ()=>{
  const newP = prompt('Ganti password (kosong = batal)');
  if(newP){ users = loadUsers(); users[currentUser].password = newP; saveUsers(users); alert('Password diganti'); }
}

// Deposit/Withdraw handlers
btnDeposit.onclick = ()=>{ showDWModal('deposit'); }
btnWithdraw.onclick = ()=>{ showDWModal('withdraw'); }

btnCancelDW.onclick = ()=>{ hideDWModal(); }

btnSubmitDW.onclick = ()=>{
  const amount = parseInt(dwAmount.value) || 0;
  const method = dwMethod.value.trim();
  const account = dwAccount.value.trim();
  
  if(amount <= 0) { dwMsg.innerText = 'Jumlah tidak valid'; return; }
  if(!method) { dwMsg.innerText = 'Metode pembayaran harus diisi'; return; }
  if(!account) { dwMsg.innerText = 'Nomor rekening/account harus diisi'; return; }
  
  if(currentDWType === 'withdraw') {
    if(amount > (users[currentUser].balance || 0)) {
      dwMsg.innerText = 'Saldo tidak mencukupi';
      return;
    }
  }
  
  // Create transaction
  const newTransaction = {
    id: Date.now(),
    username: currentUser,
    type: currentDWType,
    amount: amount,
    method: method,
    account: account,
    status: 'pending',
    date: new Date().toLocaleString('id-ID')
  };
  
  transactions.unshift(newTransaction);
  saveTransactions(transactions);
  
  if(currentDWType === 'withdraw') {
    // For withdrawals, deduct immediately (pending approval)
    users[currentUser].balance -= amount;
    saveUsers(users);
    $('#displayBalance').innerText = 'Rp ' + format(users[currentUser].balance || 0);
  }
  
  dwMsg.innerText = 'Permintaan ' + currentDWType + ' berhasil dikirim. Silakan hubungi admin untuk konfirmasi.';
  renderTransactionHistory();
  
  // If admin is logged in, refresh pending transactions
  if(users[currentUser]?.isAdmin) {
    renderPendingTransactions();
  }
}

function renderTransactionHistory() {
  const table = $('#transactionHistoryTable tbody');
  table.innerHTML = '';
  
  const userTransactions = transactions
    .filter(t => t.username === currentUser)
    .slice(0, 10); // Show last 10 transactions
  
  userTransactions.forEach(t => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${t.type}</td>
      <td>Rp ${format(t.amount)}</td>
      <td class="${t.status}">${t.status}</td>
      <td>${t.date}</td>
    `;
    table.appendChild(row);
  });
}

function renderPendingTransactions() {
  const table = $('#pendingTransactionsTable tbody');
  table.innerHTML = '';
  
  const pendingTransactions = transactions.filter(t => t.status === 'pending');
  
  pendingTransactions.forEach(t => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${t.username}</td>
      <td>${t.type}</td>
      <td>Rp ${format(t.amount)}</td>
      <td>
        <button class="btn" onclick="approveTransaction(${t.id})">Approve</button>
        <button class="btn" style="background:#ef4444" onclick="rejectTransaction(${t.id})">Reject</button>
      </td>
    `;
    table.appendChild(row);
  });
}

function approveTransaction(id) {
  const transaction = transactions.find(t => t.id === id);
  if(!transaction) return;
  
  if(transaction.type === 'deposit') {
    // For deposits, add the balance when approved
    users[transaction.username].balance += transaction.amount;
    saveUsers(users);
  } else if(transaction.type === 'withdraw') {
    // For withdrawals, the amount was already deducted when requested
    // No further action needed on approval
  }
  
  transaction.status = 'approved';
  saveTransactions(transactions);
  renderPendingTransactions();
  renderUsersTable();
  
  if(currentUser === transaction.username) {
    $('#displayBalance').innerText = 'Rp ' + format(users[currentUser].balance || 0);
    renderTransactionHistory();
  }
}

function rejectTransaction(id) {
  const transaction = transactions.find(t => t.id === id);
  if(!transaction) return;
  
  if(transaction.type === 'withdraw') {
    // For withdrawals, return the deducted amount if rejected
    users[transaction.username].balance += transaction.amount;
    saveUsers(users);
  }
  
  transaction.status = 'rejected';
  saveTransactions(transactions);
  renderPendingTransactions();
  renderUsersTable();
  
  if(currentUser === transaction.username) {
    $('#displayBalance').innerText = 'Rp ' + format(users[currentUser].balance || 0);
    renderTransactionHistory();
  }
}

// Admin functions
function renderUsersTable(){
  const tbody = $('#usersTable tbody');
  tbody.innerHTML = '';
  Object.entries(users).forEach(([u, d])=>{
    if(u === 'adminfeb') return; // skip admin
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u}</td><td>Rp ${format(d.balance)}</td>
      <td><button class="btn" onclick="resetUser('${u}')">Reset</button></td>`;
    tbody.appendChild(tr);
  });
}

function resetUser(u){
  if(!confirm(`Reset saldo ${u} ke 10.000?`)) return;
  users[u].balance = 10000;
  saveUsers(users);
  renderUsersTable();
}

$('#btnAddBalance').onclick = ()=>{
  const u = $('#adminUser').value.trim();
  const a = parseInt($('#adminAmount').value) || 0;
  if(!u || !a) return alert('Isi user & amount');
  if(!users[u]) return alert('User tidak ditemukan');
  users[u].balance += a;
  saveUsers(users);
  renderUsersTable();
  alert(`Saldo ${u} ditambah Rp ${format(a)}`);
}

$('#btnResetAll').onclick = ()=>{
  if(!confirm('Reset semua user (kecuali admin)?')) return;
  Object.entries(users).forEach(([u, d])=>{
    if(u !== 'adminfeb') d.balance = 10000;
  });
  saveUsers(users);
  renderUsersTable();
}

// Game logic
let gameState = 'waiting'; // waiting, counting, flying, crashed
let countdown = 5;
let multiplier = 1.0;
let targetMultiplier = 1.0;
let autoCashout = 0;
let betAmount = 1000;
let roundId = 0;
let roundHistory = [];
let interval;

const rocket = $('#rocket');
const multDisplay = $('#mult');
const countdownDisplay = $('#countdown');
const betInput = $('#betInput');
const autoInput = $('#autoInput');
const btnPlace = $('#btnPlace');
const btnHalf = $('#btnHalf');
const btnFull = $('#btnFull');
const roundState = $('#roundState');
const historyBar = $('#historyBar');

function updateGame(){
  if(gameState === 'waiting'){
    if(!currentUser) return;
    roundState.innerText = 'Ronde: Menunggu taruhan';
    btnPlace.disabled = false;
    btnHalf.disabled = true;
    btnFull.disabled = true;
  } else if(gameState === 'counting'){
    countdown -= 0.05;
    countdownDisplay.innerText = countdown.toFixed(1);
    if(countdown <= 0){
      gameState = 'flying';
      multiplier = 1.0;
      targetMultiplier = 1 + (Math.random() * 10); // 1x to 11x
      roundState.innerText = 'Ronde: Terbang!';
      btnPlace.disabled = true;
      btnHalf.disabled = false;
      btnFull.disabled = false;
    }
  } else if(gameState === 'flying'){
    multiplier += 0.02;
    multDisplay.innerText = 'x' + multiplier.toFixed(2);
    rocket.style.bottom = (12 + (multiplier-1)*10) + 'px';
    
    // Check auto cashout
    if(autoCashout > 0 && multiplier >= autoCashout){
      cashout();
      return;
    }
    
    // Random crash
    if(multiplier >= targetMultiplier){
      gameState = 'crashed';
      roundState.innerText = 'Ronde: Jatuh! x' + multiplier.toFixed(2);
      setTimeout(()=>{
        roundHistory.unshift(multiplier.toFixed(2));
        renderHistory();
        gameState = 'waiting';
        countdown = 5;
        multiplier = 1.0;
        multDisplay.innerText = 'x1.00';
        rocket.style.bottom = '12px';
        countdownDisplay.innerText = '';
        roundState.innerText = 'Ronde: -';
        btnPlace.disabled = false;
        btnHalf.disabled = true;
        btnFull.disabled = true;
      }, 1000);
    }
  }
}

function placeBet(){
  if(gameState !== 'waiting') return;
  betAmount = parseInt(betInput.value) || 1000;
  autoCashout = parseFloat(autoInput.value) || 0;
  if(!currentUser) return alert('Login dulu');
  if(betAmount > (users[currentUser].balance || 0)) return alert('Saldo tidak cukup');
  users[currentUser].balance -= betAmount;
  saveUsers(users);
  $('#displayBalance').innerText = 'Rp ' + format(users[currentUser].balance || 0);
  gameState = 'counting';
  countdown = 5;
  roundState.innerText = 'Ronde: Hitung mundur';
  btnPlace.disabled = true;
}

function cashoutHalf(){
  if(gameState !== 'flying') return;
  const win = Math.floor(betAmount * multiplier * 0.5);
  users[currentUser].balance += win;
  saveUsers(users);
  $('#displayBalance').innerText = 'Rp ' + format(users[currentUser].balance || 0);
  roundState.innerText = 'Tarik 50%: x' + multiplier.toFixed(2) + ' | Menang: Rp ' + format(win);
  gameState = 'waiting';
  resetAfterCashout();
}

function cashout(){
  if(gameState !== 'flying') return;
  const win = Math.floor(betAmount * multiplier);
  users[currentUser].balance += win;
  saveUsers(users);
  $('#displayBalance').innerText = 'Rp ' + format(users[currentUser].balance || 0);
  roundState.innerText = 'Tarik: x' + multiplier.toFixed(2) + ' | Menang: Rp ' + format(win);
  gameState = 'waiting';
  resetAfterCashout();
}

function resetAfterCashout(){
  multiplier = 1.0;
  multDisplay.innerText = 'x1.00';
  rocket.style.bottom = '12px';
  countdownDisplay.innerText = '';
  btnPlace.disabled = false;
  btnHalf.disabled = true;
  btnFull.disabled = true;
  setTimeout(()=>{ roundState.innerText = 'Ronde: -'; }, 2000);
}

function renderHistory(){
  historyBar.innerHTML = '';
  roundHistory.slice(0, 15).forEach((m, i)=>{
    const el = document.createElement('div');
    el.className = 'hist';
    if(m < 2) el.className += ' low';
    else if(m < 5) el.className += ' mid';
    else el.className += ' high';
    el.innerText = 'x' + m;
    historyBar.appendChild(el);
  });
}

// Event listeners
btnPlace.onclick = placeBet;
btnHalf.onclick = cashoutHalf;
btnFull.onclick = cashout;

// Initialize
renderAuthState();
if(!currentUser) showAuth();
setInterval(updateGame, 50);
</script>
</body>
</html>