<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Jejak Hati: Kisah Anya dan Aku</title>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root{
  --title-font:"Baloo 2", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  --ui-font:"Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  --accent:#ff69b4; --accent2:#ff3a86;
  --bg:#fff2f8; --card:#ffffff; --text:#111;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:var(--ui-font);color:var(--text);overflow:hidden}
.container{position:relative;height:100vh;width:100vw;overflow:hidden}
.background{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1}
.dialog-container{position:absolute;bottom:0;left:0;width:100%;background:rgba(0,0,0,0.7);padding:20px;color:#fff;backdrop-filter:blur(5px);border-top-left-radius:16px;border-top-right-radius:16px;transform:translateY(0);transition:transform 0.3s ease}
.header{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.title{font-family:var(--title-font);font-size:20px;color:#fff;margin:0}
.heart{margin-left:auto;font-size:20px}
.char{font-family:var(--title-font);font-weight:700;color:#ff69b4;margin-bottom:6px;font-size:18px}
.story{min-height:80px;padding:14px;color:#fff;font-size:16px;line-height:1.6;white-space:pre-wrap;cursor:pointer}
.controls{display:flex;gap:10px;margin-top:12px;align-items:center}
.nextBtn{padding:10px 14px;border-radius:10px;border:none;background:#673ab7;color:#fff;font-weight:700;cursor:pointer;display:none}
.opts{margin-top:12px;display:flex;flex-direction:column;gap:10px}
.opt-btn{font-family:var(--title-font);padding:12px;border-radius:12px;border:none;background:linear-gradient(180deg,var(--accent),var(--accent2));color:#fff;font-weight:700;cursor:pointer;text-align:left}
.opt-btn:hover{transform:translateY(-3px)}
.small{font-size:13px;color:#aaa;margin-top:8px}
.progress{width:100%;height:6px;background:rgba(255,255,255,0.2);border-radius:3px;margin-top:10px}
.progress-bar{height:100%;background:var(--accent);border-radius:3px;transition:width 0.3s ease}
.chapter-indicator{font-size:12px;color:#ccc;margin-bottom:5px}

/* overlay to start music */
#overlay{position:fixed;inset:0;background:rgba(10,10,10,0.88);display:flex;align-items:center;justify-content:center;z-index:9999;cursor:pointer}
#overlay .box{color:#fff;text-align:center;padding:20px;border-radius:12px;background:rgba(0,0,0,0.7);max-width:80%}
#overlay .box h2{margin:0 0 8px;color:#ff69b4}
#overlay .box p{margin:0 0 12px;color:#ddd}

/* responsive */
@media(max-width:780px){
  .dialog-container{padding:15px}
  .story{font-size:15px;min-height:70px}
}

/* Animation for text cursor */
@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}
.text-cursor {
  display: inline-block;
  width: 2px;
  height: 1em;
  background-color: #fff;
  margin-left: 2px;
  vertical-align: middle;
  animation: blink 1s infinite;
}

/* Save indicator */
.save-indicator {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.3s;
}
.save-indicator.show {
  opacity: 1;
}
</style>
</head>
<body>

<!-- Background image -->
<img id="background" class="background" src="anya_neutral.png" alt="Background Anya">

<!-- overlay click to enable audio -->
<div id="overlay">
  <div class="box">
    <h2>JEJAK HATI: KISAH ANYA DAN AKU</h2>
    <p>Kembali ke masa SMA, temui Anya yang pendiam dan pintar. Bangun hubungan dari pertemanan hingga sesuatu yang lebih, dan hadapi konsekuensi dari setiap pilihanmu.</p>
    <button id="startBtn" style="padding:10px 14px;border-radius:10px;border:none;background:#ff69b4;color:#fff;font-weight:700;cursor:pointer">Mulai</button>
  </div>
</div>

<div class="container">
  <div class="dialog-container">
    <div class="header">
      <h1 class="title">Jejak Hati: Kisah Anya dan Aku</h1>
      <div class="heart" id="heart">ðŸ’–</div>
    </div>

    <div class="chapter-indicator" id="chapterIndicator">Chapter 1/30</div>
    <div class="progress"><div class="progress-bar" id="progressBar"></div></div>

    <div class="char" id="charName">Anya</div>

    <!-- story text area (tap to advance when text finished) -->
    <div id="story" class="story" tabindex="0" role="button" aria-label="Area cerita - ketuk untuk lanjut"></div>

    <!-- controls -->
    <div class="controls">
      <button id="nextBtn" class="nextBtn">Lanjut â–¶</button>
    </div>

    <!-- option buttons appear here after pre-dialog finished -->
    <div id="options" class="opts"></div>

    <div class="small">Tip: ketuk area teks atau tombol <strong>Lanjut</strong> setelah teks selesai. Pilih jawaban yang tulus â€” pilihan salah bisa berakibat fatal.</div>
  </div>
</div>

<div id="saveIndicator" class="save-indicator">Progress tersimpan</div>

<!-- optional music -->
<audio id="bgMusic" src="cacani.mp3" loop></audio>

<script>
/* ========== DATA: Scenes with multiple pre-lines and result-lines ========== */
/* Each scene: pre: [lines], options: [{text, result:[lines], correct:boolean, next: index|'GAMEOVER'|'END'}] */
const scenes = {
  1: {
    pre:[
      "Hari pertama sekolah di SMA Bina Bangsa. Aku masuk kelas dengan perasaan campur aduk.",
      "Ruangan ramai dengan siswa-siswa baru yang saling mengenal. Mataku tertarik pada seorang gadis dengan rambut soft-pink yang duduk sendirian di pojok.",
      "Dia terlihat pendiam, asyik dengan buku catatannya. Itulah Anya.",
      "Guru memintaku memperkenalkan diri. Setelah selesai, aku memutuskan untuk mendekatinya."
    ],
    options:[
      { text:"\"Hai, aku baru di sini. Boleh aku duduk di sebelahmu?\"",
        result:[
          "Anya mengangkat kepalanya, terlihat sedikit terkejut.",
          "Anya: \"Oh, iya... silakan. Aku Anya.\"",
          "Kesan pertama: dia pendiam tapi ramah."
        ], correct:true, next:2 },
      { text:"Diam saja dan duduk di tempat lain",
        result:[
          "Aku memilih duduk di bangku yang kosong di barisan depan.",
          "Dari belakang, aku masih bisa melihat Anya yang asyik dengan bukunya.",
          "Mungkin lain kali ada kesempatan untuk mengenalnya."
        ], correct:false, next:2 },
      { text:"\"Wah, rambutmu warna pink ya? Keren!\"",
        result:[
          "Anya: \"Eh... makasih.\"",
          "Dia terlihat sedikit tidak nyaman dan kembali fke buku catatannya.",
          "Sepertinya dia tidak suka diperhatikan berlebihan."
        ], correct:false, next:2 }
    ]
  },

  2: {
    pre:[
      "Hari kedua sekolah. Aku melihat Anya lagi di perpustakaan saat jam istirahat.",
      "Dia sedang membaca buku yang cukup tebal. Aku penasaran buku apa yang dibacanya.",
      "Aku mendekatinya pelan-pelan."
    ],
    options:[
      { text:"\"Buku apa yang kamu baca? Kelihatan menarik.\"",
        result:[
          "Anya: \"Ini novel fantasi. Ceritanya tentang...\"",
          "Dia menjelaskan dengan antusias. Rupanya dia sangat suka membaca.",
          "Kita mengobrol sebentar tentang buku sebelum bel berbunyi."
        ], correct:true, next:3 },
      { text:"Diam-diam mengamatinya dari jauh",
        result:[
          "Aku hanya mengamati dari kejauhan. Anya terlihat sangat fokus membacanya.",
          "Sepertinya dia tidak menyadari kehadiranku.",
          "Akhirnya aku memutuskan pergi tanpa berbicara dengannya."
        ], correct:false, next:3 },
      { text:"\"Wah, anak rajin ya, istirahat masih baca buku.\"",
        result:[
          "Anya: \"Hmm... memangnya kenapa?\"",
          "Dia terlihat sedikit tersinggung dengan komentarku.",
          "Aku segera meralat ucapanku dan meminta maaf."
        ], correct:false, next:3 }
    ]
  },

  3: {
    pre:[
      "Beberapa hari telah berlalu. Aku memperhatikan bahwa Anya sering sendiri.",
      "Di kelas matematika, guru memberikan soal yang cukup sulit. Kebanyakan siswa mengeluh.",
      "Tapi aku melihat Anya menyelesaikannya dengan cepat dan tepat.",
      "Waktu istirahat, aku mendekatinya untuk membahas soal itu."
    ],
    options:[
      { text:"\"Wah, kamu jago matematika ya. Bisa bantu aku?\"",
        result:[
          "Anya: \"Iya, boleh. Soal tadi memang agak tricky.\"",
          "Dia dengan sabar menjelaskan cara menyelesaikan soal tersebut.",
          "Aku semakin terkesan dengan kecerdasannya."
        ], correct:true, next:4 },
      { text:"\"Kayaknya gurunya memberi soal terlalu susah ya?\"",
        result:[
          "Anya: \"Menurutku wajar saja. Kita harus belajar lebih keras.\"",
          "Dia menjawab dengan serius. Sepertinya dia tipe yang tidak suka mengeluh."
        ], correct:false, next:4 },
      { text:"Pura-pura tidak memperhatikan dan pergi",
        result:[
          "Aku memutuskan untuk tidak mengganggunya.",
          "Tapi kemudian Anya justru yang mendekatiku dan menawarkan bantuan.",
          "Anya: \"Kamu kesulitan dengan soal tadi? Aku bisa bantu kalau mau.\""
        ], correct:false, next:4 }
    ]
  },

  // Scene 4-30 akan mengikuti pola yang sama, mengikuti alur cerita dari outline
  // Karena keterbatasan ruang, saya akan menambahkan beberapa scene penting saja

  4: {
    pre:[
      "Minggu-minggu berikutnya, aku dan Anya mulai sering berinteraksi.",
      "Kita sering belajar bersama di perpustakaan setelah sekolah.",
      "Hari ini, Anya terlihat sedikit murung. Matanya merah seperti baru menangis.",
      "Aku mendekatinya dengan hati-hati."
    ],
    options:[
      { text:"\"Kamu baik-baik saja? Ada yang bisa aku bantu?\"",
        result:[
          "Anya: \"Aku... ada masalah kecil dengan teman sekelasku.\"",
          "Dia bercerita tentang beberapa siswa yang mengolok-oloknya karena pendiam.",
          "Aku mendengarkan dengan penuh perhatian dan menghiburnya."
        ], correct:true, next:5 },
      { text:"Pura-pura tidak melihat dan langsung belajar",
        result:[
          "Aku memilih untuk tidak mencampuri urusannya.",
          "Tapi kemudian Anya mendekatiku dan bertanya apakah ada yang salah.",
          "Anya: \"Kamu kenapa? Kok tidak seperti biasanya?\""
        ], correct:false, next:5 },
      { text:"\"Jangan murung terus, nanti cepat tua lho!\"",
        result:[
          "Anya: \"Aku tidak murung-murung amat!\"",
          "Dia terlihat kesal dengan candaanku yang tidak tepat waktu.",
          "Aku menyadari kesalahanku dan meminta maaf."
        ], correct:false, next:5 }
    ]
  },

  5: {
    pre:[
      "Keesokan harinya, aku melihat beberapa siswa mengganggu Anya di koridor.",
      "Mereka mengambil buku darinya dan melemparkannya ke sana kemari.",
      "Anya terlihat sangat tidak nyaman dan mencoba mengambil bukunya kembali."
    ],
    options:[
      { text:"Langsung menegur mereka dan membela Anya",
        result:[
          "Aku: \"Hey, kembalikan bukunya! Jangan ganggu dia!\"",
          "Mereka terkejut lalu pergi sambil tertawa. Anya mengambil bukunya.",
          "Anya: \"Terima kasih...\" Matanya berkaca-kaca."
        ], correct:true, next:6 },
      { text:"Melaporkan pada guru",
        result:[
          "Aku segera pergi ke ruang guru dan melaporkan kejadian itu.",
          "Guru datang dan menegur para siswa tersebut.",
          "Anya: \"Kamu yang melaporkan? Terima kasih...\""
        ], correct:true, next:6 },
      { text:"Pura-pura tidak melihat dan lanjut berjalan",
        result:[
          "Aku memilih untuk tidak ikut campur, takut menjadi sasaran berikutnya.",
          "Tapi kemudian aku menyesal melihat Anya harus menghadapi sendiri.",
          "Esok harinya, Anya menghindariku dan terlihat kecewa."
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  // Scene-scene berikutnya akan terus berkembang sesuai outline
  // ...

  30: {
    pre:[
      "Sudah satu semester kita bersahabat. Hubungan kita semakin dekat.",
      "Anya sudah lebih terbuka dan percaya padaku. Dia sering bercerita tentang keluarganya dan mimpinya.",
      "Hari ini, kita berjalan pulang bersama seperti biasa.",
      "Tiba-tiba Anya berhenti dan menatapku serius.",
      "Anya: \"Aku... senang sekali punya teman sepertimu.\""
    ],
    options:[
      { text:"\"Aku juga senang bisa dekat denganmu, Anya.\"",
        result:[
          "Anya tersenyum manis. Matanya berbinar-binar.",
          "Anya: \"Terima kasih sudah selalu ada untukku.\"",
          "Kita melanjutkan perjalanan dengan perasaan hangat."
        ], correct:true, next:31 },
      { text:"\"Iya, sama-sama. Teman ya teman.\"",
        result:[
          "Ekspresi Anya sedikit redup mendengar jawabanku.",
          "Anya: \"Iya... teman.\"",
          "Dia terdiam sepanjang perjalanan pulang."
        ], correct:false, next:31 },
      { text:"\"Aku... sebenarnya lebih dari sekedar ingin menjadi temanmu.\"",
        result:[
          "Anya terkejut, pipinya memerah.",
          "Anya: \"A-aku... harus pulang dulu!\"",
          "Dia berlari meninggalkanmu, terlihat grogi dan bingung."
        ], correct:false, next:31 }
    ]
  },

  // Scene 31-50 (Bagian 2: Awal Romansa) akan ditambahkan kemudian
  // ...

  // Akhir dari Bagian 1
  GAMEOVER: {
    pre: [
      "Kamu gagal membangun hubungan dengan Anya.",
      "Dia memutuskan untuk menjauh dan hubungan kalian tidak pernah menjadi lebih dekat.",
      "Misi masa lalu gagal."
    ],
    options: [
      { text: "Mulai Ulang", result: [], correct: true, next: 1 }
    ]
  },

  END: {
    pre: [
      "Selamat! Kamu berhasil melewati Bagian 1 dari cerita ini.",
      "Kamu dan Anya sekarang memiliki hubungan yang dekat dan saling percaya.",
      "Lanjutkan ke Bagian 2: Awal Romansa di update berikutnya!"
    ],
    options: [
      { text: "Main Lagi", result: [], correct: true, next: 1 }
    ]
  }
}; // end scenes

/* ========== APP LOGIC ========== */
const storyEl = document.getElementById('story');
const optsEl = document.getElementById('options');
const charNameEl = document.getElementById('charName');
const heartEl = document.getElementById('heart');
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('startBtn');
const nextBtn = document.getElementById('nextBtn');
const bgMusic = document.getElementById('bgMusic');
const backgroundEl = document.getElementById('background');
const progressBar = document.getElementById('progressBar');
const chapterIndicator = document.getElementById('chapterIndicator');
const saveIndicator = document.getElementById('saveIndicator');

let sceneIndex = 1;       // current scene number
let preIndex = 0;         // which pre-line are we on
let resultMode = false;   // showing result lines after choice
let resultIndex = 0;      // index into result lines
let currentOptions = [];  // options for current scene (shuffled)
let typing = false;       // whether typewriter is running
let currentOpt = null;    // currently selected option
let playerName = "Kamu";  // default player name

/* Helper: set background image based on emotion */
function setBackground(state){
  const map = { neutral:'anya_neutral.png', happy:'anya_happy.png', angry:'anya_angry.png', sad:'anya_sad.png' };
  backgroundEl.src = map[state] || map.neutral;
}

/* Update progress bar and chapter indicator */
function updateProgress() {
  const totalScenes = 30; // Total scenes in Part 1
  const progress = (sceneIndex / totalScenes) * 100;
  progressBar.style.width = `${progress}%`;
  chapterIndicator.textContent = `Chapter ${sceneIndex}/30`;
}

/* Show save indicator */
function showSaveIndicator() {
  saveIndicator.classList.add('show');
  setTimeout(() => {
    saveIndicator.classList.remove('show');
  }, 2000);
}

/* Save game progress to localStorage */
function saveGame() {
  const saveData = {
    sceneIndex,
    preIndex,
    timestamp: Date.now()
  };
  localStorage.setItem('jejakHati_save', JSON.stringify(saveData));
  showSaveIndicator();
}

/* Load game progress from localStorage */
function loadGame() {
  const saveData = localStorage.getItem('jejakHati_save');
  if (saveData) {
    return JSON.parse(saveData);
  }
  return null;
}

/* escape */
function esc(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* Typewriter: show one full string (not array). Calls cb when done. */
function typeWriterSingle(text, cb){
  typing = true;
  storyEl.innerHTML = '';
  let i = 0;
  function step(){
    i++;
    storyEl.innerHTML = esc(text.slice(0,i)).replace(/\n/g,'<br>') + '<span class="text-cursor"></span>';
    if(i < text.length) setTimeout(step, 24);
    else { 
      typing=false; 
      storyEl.innerHTML = esc(text).replace(/\n/g,'<br>');
      if(cb) cb(); 
    }
  }
  step();
}

/* Render pre-lines of a scene sequentially. After each pre-line finishes, show Next button (or allow tapping) to continue. When all pre-lines done, show options. */
function startScene(index){
  sceneIndex = index;
  preIndex = 0;
  resultMode = false;
  resultIndex = 0;
  currentOptions = [];
  currentOpt = null;
  setBackground('neutral');
  optsEl.innerHTML = '';
  updateProgress();
  
  const sc = scenes[sceneIndex];
  charNameEl.textContent = 'Anya';
  showNextPreLine(sc);
}

/* Show pre-line at preIndex */
function showNextPreLine(scene){
  const lines = scene.pre;
  if(preIndex >= lines.length){
    // all pre-lines done -> show options
    showOptions(scene);
    return;
  }
  // hide options & next btn until text done
  optsEl.innerHTML = '';
  nextBtn.style.display = 'none';
  // type this line
  typeWriterSingle(lines[preIndex], ()=>{
    // after typing finishes, show Next button
    nextBtn.style.display = 'inline-block';
    // Auto-save after each dialogue
    saveGame();
  });
}

/* Show options after pre-lines completed */
function showOptions(scene){
  optsEl.innerHTML = '';
  nextBtn.style.display = 'none';
  // copy & shuffle options
  currentOptions = shuffleArray(scene.options.map(o=>Object.assign({}, o)));
  currentOptions.forEach((opt, idx)=>{
    const b = document.createElement('button');
    b.className = 'opt-btn';
    b.textContent = opt.text;
    b.onclick = ()=> chooseOption(idx);
    optsEl.appendChild(b);
  });
}

/* When user chooses an option */
function chooseOption(optIndex){
  if(typing) return;
  const opt = currentOptions[optIndex];
  currentOpt = opt;
  // show result lines sequentially (require tap to advance between result lines)
  resultMode = true;
  resultIndex = 0;
  optsEl.innerHTML = '';
  // set background based on correctness
  setBackground(opt.correct ? 'happy' : 'angry');
  // begin showing first result line
  showResultLine(opt);
}

/* Show result lines with tap-to-advance */
function showResultLine(opt){
  const res = opt.result;
  if(resultIndex >= res.length){
    // finished result lines -> handle next
    if(opt.next === 'GAMEOVER'){
      setTimeout(()=> doGameOver(), 200);
    } else if(opt.next === 'END'){
      setTimeout(()=> doEnding(), 200);
    } else {
      // go to next scene index
      setTimeout(()=> startScene(opt.next), 300);
    }
    return;
  }
  // type current result line
  nextBtn.style.display = 'none';
  typeWriterSingle(res[resultIndex], ()=> {
    nextBtn.style.display = 'inline-block';
    // Auto-save after each result
    saveGame();
  });
}

/* Game Over */
function doGameOver(){
  heartEl.textContent = 'ðŸ’”';
  setBackground('sad');
  optsEl.innerHTML = '';
  const lines = ["GAME OVER â€” Hubungan dengan Anya tidak bisa diselamatkan ðŸ˜¢", "Kalau mau coba lagi, tekan Mulai Ulang."];
  let i = 0;
  function showLine(){
    if(i >= lines.length) {
      // show restart button
      const btn = document.createElement('button');
      btn.className = 'opt-btn';
      btn.textContent = 'Mulai Ulang';
    
