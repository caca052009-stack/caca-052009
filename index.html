<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Jejak Hati: Kisah Anya dan Aku â€” Full VN</title>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root{
  --title-font:"Baloo 2", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  --ui-font:"Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  --accent:#ff69b4; --accent2:#ff3a86;
  --bg:#fff2f8; --card:#ffffff; --text:#111;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:var(--ui-font);color:var(--text);overflow:hidden}
.container{position:relative;height:100vh;width:100vw;overflow:hidden}
.background{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;transition:opacity 0.5s ease}
.dialog-container{position:absolute;bottom:0;left:0;width:100%;background:rgba(0,0,0,0.7);padding:20px;color:#fff;backdrop-filter:blur(5px);border-top-left-radius:16px;border-top-right-radius:16px;transform:translateY(0);transition:transform 0.3s ease}
.header{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.title{font-family:var(--title-font);font-size:20px;color:#fff;margin:0}
.heart{margin-left:auto;font-size:20px}
.char{font-family:var(--title-font);font-weight:700;color:#ff69b4;margin-bottom:6px;font-size:18px}
.story{min-height:80px;padding:14px;color:#fff;font-size:16px;line-height:1.6;white-space:pre-wrap;cursor:pointer}
.controls{display:flex;gap:10px;margin-top:12px;align-items:center}
.nextBtn{padding:10px 14px;border-radius:10px;border:none;background:#673ab7;color:#fff;font-weight:700;cursor:pointer;display:none}
.opts{margin-top:12px;display:flex;flex-direction:column;gap:10px}
.opt-btn{font-family:var(--title-font);padding:12px;border-radius:12px;border:none;background:linear-gradient(180deg,var(--accent),var(--accent2));color:#fff;font-weight:700;cursor:pointer;text-align:left;transition:transform 0.2s ease, opacity 0.2s ease}
.opt-btn:hover{transform:translateY(-3px)}
.small{font-size:13px;color:#aaa;margin-top:8px}

/* overlay to start music */
#overlay{position:fixed;inset:0;background:rgba(10,10,10,0.88);display:flex;align-items:center;justify-content:center;z-index:9999;cursor:pointer}
#overlay .box{color:#fff;text-align:center;padding:20px;border-radius:12px;background:rgba(0,0,0,0.7);max-width:80%}
#overlay .box h2{margin:0 0 8px;color:#ff69b4}
#overlay .box p{margin:0 0 12px;color:#ddd}

/* responsive */
@media(max-width:780px){
  .dialog-container{padding:15px}
  .story{font-size:15px;min-height:70px}
  .title{font-size:18px}
}

/* Animation for text cursor */
@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}
.text-cursor {
  display: inline-block;
  width: 2px;
  height: 1em;
  background-color: #fff;
  margin-left: 2px;
  vertical-align: middle;
  animation: blink 1s infinite;
}

/* Save indicator */
.save-indicator {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.3s ease;
}
.save-indicator.show {
  opacity: 1;
}
</style>
</head>
<body>

<!-- Background image -->
<img id="background" class="background" src="anya_neutral.png" alt="Background Anya">

<!-- overlay click to enable audio -->
<div id="overlay">
  <div class="box">
    <h2>JEJAK HATI: KISAH ANYA DAN AKU</h2>
    <p>Kamu diberi kesempatan kembali ke masa lalu untuk memperbaiki hubungan dengan Anya. Klik 'Mulai' atau ketuk layar untuk mulai musik dan permainan.</p>
    <button id="startBtn" style="padding:10px 14px;border-radius:10px;border:none;background:#ff69b4;color:#fff;font-weight:700;cursor:pointer">Mulai</button>
  </div>
</div>

<!-- Save indicator -->
<div class="save-indicator" id="saveIndicator">Progress tersimpan</div>

<div class="container">
  <div class="dialog-container">
    <div class="header">
      <h1 class="title">Jejak Hati â€” Kisah Anya dan Aku</h1>
      <div class="heart" id="heart">ðŸ’–</div>
    </div>

    <div class="char" id="charName">Anya</div>

    <!-- story text area (tap to advance when text finished) -->
    <div id="story" class="story" tabindex="0" role="button" aria-label="Area cerita - ketuk untuk lanjut"></div>

    <!-- controls -->
    <div class="controls">
      <button id="nextBtn" class="nextBtn">Lanjut â–¶</button>
    </div>

    <!-- option buttons appear here after pre-dialog finished -->
    <div id="options" class="opts"></div>

    <div class="small">Tip: ketuk area teks atau tombol <strong>Lanjut</strong> setelah teks selesai. Pilih jawaban yang tulus â€” satu salah â†’ Game Over.</div>
  </div>
</div>

<!-- optional music -->
<audio id="bgMusic" src="cacani.mp3" loop></audio>

<script>
/* ========== DATA: Scenes with multiple pre-lines and result-lines ========== */
/* Each scene: pre: [lines], options: [{text, result:[lines], correct:boolean, next: index|'GAMEOVER'|'END'}] */
const scenes = {
  1: {
    pre:[
      "Kamu terbangun dan agak melongo â€” ini terasa seperti kembali ke masa SMA.",
      "Kelas penuh suara: bisik, tawa, notifikasi. Di pojok, cewek rambut soft-pink lagi doodle â€” Anya.",
      "Dia menoleh, senyum kecil. Mata kalian sempat bertemu.",
      "Anya: \"Eh, kamu anak baru ya? Kok aku baru liat?\"",
      "Kamu: \"Iya nih, agak nervous tapi excited.\""
    ],
    options:[
      { text:"â€œBoleh nggak aku duduk di sini? Biar gampang kenalan.â€",
        result:[
          "Anya: \"Boleh dong, hati-hati ya jangan ganggu catetanku hehe.\"",
          "Kamu duduk, kalian mulai ngobrol ringan soal kelas dan anime yang lagi hits.",
          "Dia tertawa beberapa kali karena candaanmu, suasana jadi hangat."
        ], correct:true, next:2 },
      { text:"â€œMales kenalan, mending aku sendiri aja.â€",
        result:[
          "Anya: \"Oh yaudah, kalau gitu.\"",
          "Wajahnya berubah dingin, dia balik ngelanjutin catetan."
        ], correct:false, next:'GAMEOVER' },
      { text:"â€œSsstâ€¦ aku stalking IG kamu, followers-mu banyak.â€",
        result:[
          "Anya: \"Eh? Kok stalking? Itu creepy banget loh.\"",
          "Dia langsung manyun, suasana awkward."
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  2: {
    pre:[
      "Kamu duduk di samping Anya. Guru belum masuk, jam masih santai.",
      "Anya: \"Lu suka anime gak? Mana favorit lu?\"",
      "Kamu: \"Suka, Spy x Family favorit. Lucu tapi hangat.\""
    ],
    options:[
      { text:"â€œSpy x Family! Sama, Anya juga suka!â€",
        result:[
          "Anya: \"Ih serius? Keren juga, kita match deh.\"",
          "Kalian bahas karakter favorit, obrolan jadi cair."
        ], correct:true, next:3 },
      { text:"â€œAnime? Cuma nonton 5 menit doang sih.â€",
        result:[
          "Anya: \"Wah bukan fans beneran dongâ€¦\""
        ], correct:false, next:'GAMEOVER' },
      { text:"â€œAnime? Itu buat bocah.â€",
        result:[
          "Anya: \"Masa? Aku agak tersinggung nih.\""
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  3: {
    pre:[
      "Bel berbunyi sebentar. Di papan ada PR Matematika yang ninggal.",
      "Anya: \"Gw stuck di nomor 3 nih, pusing deh.\"",
      "Kamu buka buku, ngeliatin soal sambil tarik napas."
    ],
    options:[
      { text:"\"Santai, aku jelasin pelanâ€”kita selesaiin bareng.\"",
        result:[
          "Kamu jelasin langkah-langkah dengan sabar, sambil gambar di buku.",
          "Anya: \"Wah jadi ngerti! Makasih ya â€” kamu keren.\"",
          "Kalian saling senyum, feel jadi lebih deket."
        ], correct:true, next:4 },
      { text:"\"Tanya guru aja ntar, santai.\"",
        result:[
          "Anya: \"Tapi aku pengen ngerti sekarang...\""
        ], correct:false, next:'GAMEOVER' },
      { text:"\"Nyontek aja besok, gampang.\"",
        result:[
          "Anya: \"Nggak deh, aku gak nyaman gitu.\""
        ], correct:false, next:'GAMEOVER' },
      { text:"\"Gini doang kok susah.\"",
        result:[
          "Anya: \"Jangan meremehkan aku dong.\""
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  4: {
    pre:[
      "PR beres, kelas santai. Kamu mencoba lempar jokes receh buat nge-break mood.",
      "Kamu: \"Tau gak bedanya kamu sama sinyal?\"",
      "Anya: \"Apa tuh?\""
    ],
    options:[
      { text:"\"Sinyal suka hilang, tapi kamu bikin aku loss in thought.\" (gombal receh)",
        result:[
          "Anya: \"Aduh gombalâ€”tapi lucu juga sih.\"",
          "Kalian ketawa bareng, dia sering menatap waktu kamu bicara."
        ], correct:true, next:5 },
      { text:"\"Nggak ada, semua sama aja.\"",
        result:[
          "Anya: \"Kok kamu pasif, boring deh.\""
        ], correct:false, next:'GAMEOVER' },
      { text:"\"Ntar gue bilang ke temen kalo kamu awkward.\"",
        result:[
          "Anya: \"Eh jangan ngomong gitu dong.\""
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  5: {
    pre:[
      "Jam hampir pulang. Anya beresin tas pelan, mukanya adem tapi ada ragu.",
      "Anya melirik: \"Kamu mau kemana setelah ini?\""
    ],
    options:[
      { text:"\"Mau pulang bareng? Kita mampir kantin bentar.\"",
        result:[
          "Anya: \"Mau dong, makasih ya â€” jadi nggak sepi pulang.\"",
          "Kamu merasa deg-degan tapi bahagia."
        ], correct:true, next:6 },
      { text:"\"Aku buru-buru, pulang sendiri aja.\"",
        result:[
          "Anya: \"Oh yaudah...\" (senyum pudar)"
        ], correct:false, next:'GAMEOVER' },
      { text:"\"Gue ada janji, maaf nggak bisa.\"",
        result:[
          "Anya: \"Kalau gitu yaudahlah.\""
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  /* Outside scenes */
  6: {
    pre:[
      "Di kantin, bau gorengan dan suara pedagang bikin perut protes.",
      "Anya: \"Mau makan apa nih? Aku bingung.\"",
      "Kamu: \"Ayo pilih, gue traktir. Pilih yang kamu suka.\""
    ],
    options:[
      { text:"\"Seblak level sedang aja, biar pas.\"",
        result:[
          "Anya: \"Kok kamu tau selera aku? Keren.\"",
          "Kalian pesan dan duduk, obrolan santai berlanjut."
        ], correct:true, next:7 },
      { text:"\"Ambil es teh aja, yang manis stabil.\"",
        result:[
          "Anya: \"Es teh juga enak sih... tapi aku lagi pengen pedes.\""
        ], correct:false, next:'GAMEOVER' },
      { text:"\"Gue nggak beliin, kamu aja yang bayar.\"",
        result:[
          "Anya: \"Serius? Kok pelit sih.\""
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  7: {
    pre:[
      "Makan sambil ngobrol tentang film, cita-cita, dan meme konyol.",
      "Anya: \"Kamu tipe yang romantis nggak sih?\"",
      "Kamu: \"Tergantung sama siapa.\""
    ],
    options:[
      { text:"\"Kalau sama kamu, aku bakal perhatian banget.\"",
        result:[
          "Anya: \"Aduh baper nih, tapi lucu juga.\"",
          "Ia cerita hal kecil yang bikin dia nyaman."
        ], correct:true, next:8 },
      { text:"\"Romantis? Gue kayak ghost, nggak keliatan.\"",
        result:[
          "Anya: \"Ghost? Maksudnya apa sih?\""
        ], correct:false, next:'GAMEOVER' },
      { text:"\"Romantis? Hanya ke makanan.\"",
        result:[
          "Anya: \"Wah kamu aneh banget.\""
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  8: {
    pre:[
      "TibaÂ² hujan turun deras. Semua cari tempat teduh, suasana jadi dramatis.",
      "Anya: \"Gila nggak bawa payung!\"",
      "Kamu: \"Tenang, pakai payung gue aja.\""
    ],
    options:[
      { text:"\"Ayo pakai payung gue, berdua aja.\"",
        result:[
          "Kalian berdempetan di bawah payung, hujan jadi latar romantis.",
          "Anya: \"Sempit tapi hangat...\" (tersipu)."
        ], correct:true, next:9 },
      { text:"\"Lari aja basah, biar dramatis.\"",
        result:[
          "Anya: \"Tapi nanti bisa sakit tau.\""
        ], correct:false, next:'GAMEOVER' },
      { text:"\"Tunggu aja sampai reda.\"",
        result:[
          "Anya: \"Tapi nggak nyaman kalo kebasahan.\""
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  9: {
    pre:[
      "Hujan reda. Kalian duduk di taman, aroma tanah basah bikin adem.",
      "Anya: \"Makasih ya udah nemenin dari siang.\"",
      "Kamu: \"Sama-sama, aku malah seneng.\""
    ],
    options:[
      { text:"\"Boleh gak aku jemput kamu besok? Biar bisa nongkrong lagi.\"",
        result:[
          "Anya: \"Boleh banget! Aku jadi nggak sabar.\"",
          "Rasa nyaman antar kalian makin jelas."
        ], correct:true, next:10 },
      { text:"\"Mending jangan sering-sering deh, capek.\"",
        result:[
          "Anya: \"Kenapa sih kamu dingin banget?\""
        ], correct:false, next:'GAMEOVER' },
      { text:"\"Semuanya cuma buat lucu-lucuan doang.\"",
        result:[
          "Anya: \"Jadi semua ini iseng?\""
        ], correct:false, next:'GAMEOVER' }
    ]
  },

  10: {
    pre:[
      "Senja oranye turun. Kalian duduk di bangku taman, suasana hening dan hangat.",
      "Anya memandang: \"Kamu... suka aku nggak sih?\"",
      "Jantungmu kencangâ€”ini momen."
    ],
    options:[
      { text:"\"Aku suka banget, mau jagain kamu tiap hari?\"",
        result:[
          "Anya menunduk sebentar, lalu tersenyum lebar: \"Iya... aku mau juga.\"",
          "Kamu lega â€” misi masa lalu berhasil."
        ], correct:true, next:'END' },
      { text:"\"Ah nggak lah, cuma bercanda.\"",
        result:[
          "Anya: \"Apa? Jadi semua ini mainan?\"",
          "Dia sedih, suasana retak."
        ], correct:false, next:'GAMEOVER' },
      { text:"\"Kita jadi temen dulu aja deh.\"",
        result:[
          "Anya: \"Oh... yaudahlah kalau kamu mau.\"",
          "Kalau begitu kamu nggak dapet Happy Ending kali ini."
        ], correct:false, next:'GAMEOVER' }
    ]
  }
}; // end scenes

/* ========== APP LOGIC ========== */
const storyEl = document.getElementById('story');
const optsEl = document.getElementById('options');
const charNameEl = document.getElementById('charName');
const heartEl = document.getElementById('heart');
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('startBtn');
const nextBtn = document.getElementById('nextBtn');
const bgMusic = document.getElementById('bgMusic');
const backgroundEl = document.getElementById('background');
const saveIndicator = document.getElementById('saveIndicator');

let sceneIndex = 1;       // current scene number 1..10
let preIndex = 0;         // which pre-line are we on
let resultMode = false;   // showing result lines after choice
let resultIndex = 0;      // index into result lines
let currentOptions = [];  // options for current scene (shuffled)
let typing = false;       // whether typewriter is running
let currentOpt = null;    // currently selected option
let typeSpeed = 24;       // typing speed in ms

/* Helper: set background image based on emotion */
function setBackground(state){
  const map = { 
    neutral:'anya_neutral.png', 
    happy:'anya_happy.png', 
    angry:'anya_angry.png', 
    sad:'anya_sad.png',
    shy:'anya_shy.png',
    surprised:'anya_surprised.png'
  };
  backgroundEl.style.opacity = 0;
  setTimeout(() => {
    backgroundEl.src = map[state] || map.neutral;
    backgroundEl.style.opacity = 1;
  }, 300);
}

/* escape */
function esc(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* Typewriter: show one full string (not array). Calls cb when done. */
function typeWriterSingle(text, cb){
  typing = true;
  storyEl.innerHTML = '';
  let i = 0;
  function step(){
    i++;
    storyEl.innerHTML = esc(text.slice(0,i)).replace(/\n/g,'<br>') + '<span class="text-cursor"></span>';
    if(i < text.length) setTimeout(step, typeSpeed);
    else { 
      typing=false; 
      storyEl.innerHTML = esc(text).replace(/\n/g,'<br>');
      if(cb) cb(); 
    }
  }
  step();
}

/* Save game progress */
function saveProgress() {
  const progress = {
    sceneIndex,
    preIndex,
    timestamp: Date.now()
  };
  localStorage.setItem('anyaGameProgress', JSON.stringify(progress));
  
  // Show save indicator
  saveIndicator.classList.add('show');
  setTimeout(() => {
    saveIndicator.classList.remove('show');
  }, 2000);
}

/* Load game progress */
function loadProgress() {
  const saved = localStorage.getItem('anyaGameProgress');
  if (saved) {
    try {
      const progress = JSON.parse(saved);
      sceneIndex = progress.sceneIndex;
      preIndex = progress.preIndex;
      return true;
    } catch (e) {
      console.error('Error loading progress:', e);
    }
  }
  return false;
}

/* Render pre-lines of a scene sequentially. After each pre-line finishes, show Next button (or allow tapping) to continue. When all pre-lines done, show options. */
function startScene(index){
  sceneIndex = index;
  preIndex = 0;
  resultMode = false;
  resultIndex = 0;
  currentOptions = [];
  currentOpt = null;
  setBackground('neutral');
  optsEl.innerHTML = '';
  const sc = scenes[sceneIndex];
  charNameEl.textContent = 'Anya';
  showNextPreLine(sc);
  saveProgress();
}

/* Show pre-line at preIndex */
function showNextPreLine(scene){
  const lines = scene.pre;
  if(preIndex >= lines.length){
    // all pre-lines done -> show options
    showOptions(scene);
    return;
  }
  // hide options & next btn until text done
  optsEl.innerHTML = '';
  nextBtn.style.display = 'none';
  // type this line
  typeWriterSingle(lines[preIndex], ()=>{
    // after typing finishes, show Next button
    nextBtn.style.display = 'inline-block';
    saveProgress();
  });
}

/* Show options after pre-lines completed */
function showOptions(scene){
  optsEl.innerHTML = '';
  nextBtn.style.display = 'none';
  // copy & shuffle options
  currentOptions = shuffleArray(scene.options.map(o=>Object.assign({}, o)));
  currentOptions.forEach((opt, idx)=>{
    const b = document.createElement('button');
    b.className = 'opt-btn';
    b.textContent = opt.text;
    b.onclick = ()=> chooseOption(idx);
    optsEl.appendChild(b);
  });
}

/* When user chooses an option */
function chooseOption(optIndex){
  if(typing) return;
  const opt = currentOptions[optIndex];
  currentOpt = opt;
  // show result lines sequentially (require tap to advance between result lines)
  resultMode = true;
  resultIndex = 0;
  optsEl.innerHTML = '';
  // set background based on correctness
  setBackground(opt.correct ? 'happy' : 'angry');
  // begin showing first result line
  showResultLine(opt);
}

/* Show result lines with tap-to-advance */
function showResultLine(opt){
  const res = opt.result;
  if(resultIndex >= res.length){
    // finished result lines -> handle next
    if(opt.next === 'GAMEOVER'){
      setTimeout(()=> doGameOver(), 200);
    } else if(opt.next === 'END'){
      setTimeout(()=> doEnding(), 200);
    } else {
      // go to next scene index
      setTimeout(()=> startScene(opt.next), 300);
    }
    return;
  }
  // type current result line
  nextBtn.style.display = 'none';
  typeWriterSingle(res[resultIndex], ()=> {
    nextBtn.style.display = 'inline-block';
  });
}

/* Game Over */
function doGameOver(){
  heartEl.textContent = 'ðŸ’”';
  setBackground('sad');
  optsEl.innerHTML = '';
  const lines = ["GAME OVER â€” Anya kecewa ðŸ˜¢", "Kalau mau coba lagi, tekan Mulai Ulang."];
  let i = 0;
  function showLine(){
    if(i >= lines.length) {
      // show restart button
      const btn = document.createElement('button');
      btn.className = 'opt-btn';
      btn.textContent = 'Mulai Ulang';
      btn.onclick = restartGame;
      optsEl.appendChild(btn);
      return;
    }
    typeWriterSingle(lines[i], ()=>{
      i++;
      nextBtn.style.display = 'inline-block';
    });
  }
  // start the gameover sequence
  storyEl.innerHTML = '';
  nextBtn.style.display = 'none';
  // override nextBtn to continue lines
  nextBtn.onclick = ()=>{
    nextBtn.style.display='none';
    
